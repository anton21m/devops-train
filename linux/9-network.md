# Как работает интернет. Модель OSI

Basic Reference Model Open Systems Interconnection (OSI) model

Сетевая модель OSI имеет 7 уровней:
![](./9-network/osi.png)
на 7 уровне информация представляется в виде данных, на 1 уровне в виде бит
Процесс преобразования данных в биты называется инкапсуляцией, а битов в данные декапсуляцией.

L1 - физический, PDU (единицы нагрузки - бит). На этом уровне работают провода патч панели, сетевые концентраторы, сетевой адаптер
L2 - канальный. PDU (единицы нагрузки - кадр, фрейм). На этом уровне появляется адресация, адресомявляется MAC адрес. Ответственен за доставку фреймов адресату и их целостность. Протокол ARP . Адресация только в пределах 1 сетевого сегмента и ничего не знает о маршрутизации. На L2 работают комутаторы, мосты, драйвера сетевого адаптера
L3 - сетевой. PDU (единицы нагрузки - пакет). На этом уровне появляется маршрутизация. Маршрутизаторы, Роутеры. Получает MAc адерес от L2 и занимается построением маршрута от одного устройства к другому с учетом неполадок сети. На сетевом уровне используется активно ARP (протокол определения адреса). С помощью него mac адреса преобразуются в IP адреса
L4 - транспортный. PDU (единицы нагрузки - сегмент/датаграмма). На этом уровне появляется понятие портов. Задача 4 уровня - транспорт пакетов. Протокол TCP (контролирует целостнось, данные делятся на сегменты)/UDP (датаграмма).
L5 - сеансовый. PDU (единицы нагрузки - данные). TCP/IP . сессии
L6 - представление . Занимается отображение текста, картинок, кодировка Asc2 в utf-8, шифрование данных
L7 - прикладной. протоколы SMTP, RDP, HTTP

Подробнее здесь
https://selectel.ru/blog/osi-for-beginners/

#### Стек протоколов TCP/IP

TCP/IP - Transmission Control Protocol / Internet protocol протокол управления передачей / протокол интернета

Документом, регламентирующим уровневую архитектуру модели и описывающий все протоколы, входящие в TCP/IP, является RFC 1122 https://datatracker.ietf.org/doc/html/rfc1122 (rus http://rfc.com.ru/rfc1122.htm). Он публикуется IETF

К документации по использованию лучше обрашаться к стандарту RFC 1122

Модель TCP/IP

![](./9-network/tcp-ip.png)
![](./9-network/tcp-ip2.png)

В межсетевом уровне заложен основоной принцип построение интернета. Локальные сети по всему миру объединены в глобальную, а передачу между сетями осуществляет магистральный и пограничные маршрутизаторы.
Для организации были введены маски под сети и Ip адресы.
Маска подсети позволяет маршрутизатору понять как и куда передавать пакет. ПодСетью может являться любая сеть со своими протоколами. Маршрутизатор передают пакет напрямую если получатель находится в той же подсети, если различаются подсети пакет передается на 2 маршрутизатор, со 2 на 3 и т.д. по цепочке пока не достигнет получателя.
Протокол интернета или IP импользуется маршрутизатором чтобы определить какой подсети принадлежит получатель. IP есть у каждого сетевого устройства
В глобальной сети не может существовать 2 устройства с одинаковым IP. 
Сушествует Ipv4 (4 октета - 1 октет 8 бит) и Ipv6.
![](./9-network/ipv4-ipv6.png)

Маска подсети IPV4 имеет 255.255.255.0

Помимо IP в межсетевом уровне еще задействованы протоколы ICMP и IGMP.
ICMP межсетевой протокол управляющих сообщений используется в качестве поддержки маршрутизаторами и др. сетевыми устройствами. Внутри сети он служит для доставки сообщений об ошибках и операционной информации, сообщающий об успехе или ошибке при связи с другим устройством. Он сообщает о недоступности устройств, используется в ping и traceroute командах.
ICMP не передает какие либо данные что отличает его от протоколов, работающих на транспортном уровне, т.к. TCP, UDP. 

![](./9-network/icmp.png)

Сетевые устройства объединяются в группы при помощи IGMP протокола группового управления используемымы хостами и роутерами в IPV4 сетях. IGMP организет групповую передачу информации широковещания что позволяет сетям направлять уже сами данные только хостам запросившим ее. Это удобно например для онлайн игр или потоковой передачи мультимедиа  
В сетях IPV6 вместо IGMP используется MLD - multicast Listener Discovery протокол поиска групповых слушателей.

Стеки TCP/IP приложение прикладного уровня общаются также с предыдушим транспортным  и они могу работать с TCP или UDP но понимают только адресное значение в виде IP и порта а не назначение самих данных и принципы их работы.

Ip присваиваются каждому компьютеру межсетевым уровнем, но обмен данными происходит не между компьютерамми, а между приложениями установленными на них. Чтобы получить доступ к тому или иному сетевому приложению недостаточен IP нужен еще порт, такая комюинация называет сокетом или гнездом. 

У приложений на прикладном уровне имеются собственные протоколы для обмена данными, а также фиксированный номер порта для обращения к сети. Администрация адресного пространства Интернет IANA (Internet Asigned Numbers Authority) занимающаяся выделением диапазонов IP твечат за назначение сетевым приложениям портов.
 SMTP - порт 25
 POP3 - порт 110
 HTTP - порт 80
 HTTPS - порт 443
 FTP - порт 21
 DNS - порт 53

# Point-to-Point протоколы
![](./9-network/tcp-ip3.png)
Отдельно расскажем о Point-to-Point (от точки к точке, двухточечный) протоколе, также известном как PPP. PPP уникален по своим функциям, он применяется для коммуникации между двумя маршрутизаторами без участия хоста или какой-либо сетевой структуры в промежутке. При необходимости PPP обеспечивает аутентификацию, шифрование, а также сжатие данных. Он широко используется при построении физических сетей, например, кабельных телефонных, сотовых телефонных, сетей по кабелю последовательной передачи и транк-линий (когда один маршрутизатор подключают к другому для увеличения размера сети).

У PPP есть два подвида — PPPoE (PPP по Ethernet) и PPPoA (PPP через асинхронный способ передачи данных — ATM), интернет-провайдеры часто их используют для DSL соединений.

PPP и его старший аналог SLIP (протокол последовательной межсетевой связи) формально относятся к межсетевому уровню TCP/IP, но в силу особого принципа работы, иногда выделяются в отдельную категорию. Преимущество PPP в том, что для установки соединения не требуется сетевая инфраструктура, а необходимость маршрутизаторов отпадает. Эти факторы обуславливают специфику использования PPP протоколов.



# Что такое DNS и для чего используется эта служба

Чтобы не запоминать числовые адреса интернет-серверов была создана DNS — служба доменных имен. DNS всегда слушает на 53 порту и преобразует буквенные имена сетевых доменов в числовые IP-адреса и наоборот. Служба DNS позволяет не запоминать IP — компьютер самостоятельно посылает запрос «какой IP у selectel.ru?» на 53 порт DNS-сервера, полученного от поставщика услуг интернет.

DNS-сервер дает компьютеру ответ «IP для selectel.ru — XXX.XXX.XXX.XXX». Затем, компьютер устанавливает соединение с веб-сервером полученного IP, который слушает на порту 80 для HTTP-протокола и на порту 443 для HTTPS. 